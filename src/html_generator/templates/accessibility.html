{% extends "base.html" %}

{% block title %}Accessibility Analysis - {{ site_title }}{% endblock %}

{% block header_description %}WCAG 2.1 AA compliance analysis with detailed accessibility insights{% endblock %}

{% block content %}
<!-- Accessibility Summary Cards -->
<div class="stats-grid">
    <div class="stat-card">
        <div class="stat-header">
            <div>
                <div class="stat-value">{{ data.accessibility.summary.score or 0 }}%</div>
                <div class="stat-label">Accessibility Score</div>
                <div class="card-description">Overall accessibility compliance rating</div>
            </div>
            <div class="stat-icon" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                <i class="fas fa-universal-access"></i>
            </div>
        </div>
    </div>

    <div class="stat-card">
        <div class="stat-header">
            <div>
                <div class="stat-value">{{ data.accessibility.summary.total_issues or 0 }}</div>
                <div class="stat-label">Issues Found</div>
                <div class="card-description">Accessibility violations requiring attention</div>
            </div>
            <div class="stat-icon" style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);">
                <i class="fas fa-exclamation-triangle"></i>
            </div>
        </div>
    </div>

    <div class="stat-card">
        <div class="stat-header">
            <div>
                <div class="stat-value">{{ data.accessibility.summary.compliance_level or 'Unknown' }}</div>
                <div class="stat-label">WCAG Level</div>
                <div class="card-description">Current compliance level achieved</div>
            </div>
            <div class="stat-icon" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                <i class="fas fa-award"></i>
            </div>
        </div>
    </div>

    <div class="stat-card">
        <div class="stat-header">
            <div>
                <div class="stat-value">{{ data.accessibility.summary.headings_count or 0 }}</div>
                <div class="stat-label">Heading Elements</div>
                <div class="card-description">Total heading elements found on page</div>
            </div>
            <div class="stat-icon" style="background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);">
                <i class="fas fa-heading"></i>
            </div>
        </div>
    </div>
</div>

<!-- Element Analysis -->
<div class="content-section">
    <h2 class="section-title">
        <i class="fas fa-chart-bar"></i>
        Element Analysis Summary
    </h2>
    <div class="metrics-grid">
        <div class="metric-item">
            <div class="metric-value">{{ data.accessibility.summary.total_images or 0 }}</div>
            <div class="metric-label">Total Images</div>
        </div>
        <div class="metric-item">
            <div class="metric-value">{{ data.accessibility.summary.total_links or 0 }}</div>
            <div class="metric-label">Total Links</div>
        </div>
        <div class="metric-item">
            <div class="metric-value">{{ data.accessibility.summary.total_buttons or 0 }}</div>
            <div class="metric-label">Total Buttons</div>
        </div>
        <div class="metric-item">
            <div class="metric-value">{{ data.accessibility.summary.headings_count or 0 }}</div>
            <div class="metric-label">Heading Elements</div>
        </div>
    </div>
</div>

<!-- Issues Analysis -->
{% if data.accessibility.issues %}
<div class="content-section">
    <h2 class="section-title">
        <i class="fas fa-exclamation-triangle"></i>
        Accessibility Issues by Severity
    </h2>
    <div class="section-description">
        Issues found during WCAG 2.1 AA compliance analysis, grouped by severity level. Address high-severity issues first for maximum impact.
    </div>
    
    <!-- High Severity Issues -->
    {% set high_issues = data.accessibility.issues | selectattr("severity", "equalto", "high") | list %}
    {% if high_issues %}
    <div style="margin-bottom: 2rem;">
        <h3 style="color: #e53e3e; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
            <i class="fas fa-exclamation-circle"></i> High Severity Issues ({{ high_issues|length }})
        </h3>
        {% for issue in high_issues %}
        <div class="issue-item severity-high">
            <i class="fas fa-exclamation-circle issue-icon" style="color: #e53e3e;"></i>
            <div class="issue-content">
                <h4>{{ issue.type }} <span class="status-badge priority-high">{{ issue.severity|title }}</span></h4>
                <div class="issue-description">{{ issue.description }}</div>
                <div class="issue-guideline">{{ issue.wcag_guideline }}</div>
                <div style="margin-top: 0.5rem; padding: 0.5rem; background: #fed7d7; border-radius: 6px; border-left: 3px solid #e53e3e;">
                    <strong style="color: #742a2a;">Page:</strong> 
                    <code style="background: rgba(0,0,0,0.1); padding: 2px 4px; border-radius: 3px; font-size: 0.85rem;">{{ issue.page_url }}</code>
                </div>
                {% if issue.count > 1 %}
                <div style="margin-top: 0.5rem; font-size: 0.9rem; color: #718096;">
                    <i class="fas fa-layer-group"></i> {{ issue.count }} instances found on this page
                </div>
                {% endif %}
                {% if issue.details %}
                <div style="margin-top: 0.5rem; padding: 0.5rem; background: rgba(255,255,255,0.7); border-radius: 4px;">
                    <strong style="font-size: 0.85rem; color: #2d3748;">Affected Items:</strong>
                    <ul style="margin: 0.25rem 0 0 1rem; font-size: 0.8rem; color: #4a5568;">
                        {% for detail in issue.details %}
                        <li style="margin-bottom: 0.2rem;"><code style="background: rgba(0,0,0,0.1); padding: 1px 3px; border-radius: 2px;">{{ detail }}</code></li>
                        {% endfor %}
                        {% if issue.count > issue.details|length %}
                        <li style="font-style: italic; color: #718096;">...and {{ issue.count - issue.details|length }} more</li>
                        {% endif %}
                    </ul>
                </div>
                {% endif %}
            </div>
        </div>
        {% endfor %}
    </div>
    {% endif %}
    
    <!-- Medium Severity Issues -->
    {% set medium_issues = data.accessibility.issues | selectattr("severity", "equalto", "medium") | list %}
    {% if medium_issues %}
    <div style="margin-bottom: 2rem;">
        <h3 style="color: #dd6b20; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
            <i class="fas fa-exclamation-triangle"></i> Medium Severity Issues ({{ medium_issues|length }})
        </h3>
        {% for issue in medium_issues %}
        <div class="issue-item severity-medium">
            <i class="fas fa-exclamation-triangle issue-icon" style="color: #dd6b20;"></i>
            <div class="issue-content">
                <h4>{{ issue.type }} <span class="status-badge priority-medium">{{ issue.severity|title }}</span></h4>
                <div class="issue-description">{{ issue.description }}</div>
                <div class="issue-guideline">{{ issue.wcag_guideline }}</div>
                <div style="margin-top: 0.5rem; padding: 0.5rem; background: #feebc8; border-radius: 6px; border-left: 3px solid #dd6b20;">
                    <strong style="color: #744210;">Page:</strong> 
                    <code style="background: rgba(0,0,0,0.1); padding: 2px 4px; border-radius: 3px; font-size: 0.85rem;">{{ issue.page_url }}</code>
                </div>
                {% if issue.count > 1 %}
                <div style="margin-top: 0.5rem; font-size: 0.9rem; color: #718096;">
                    <i class="fas fa-layer-group"></i> {{ issue.count }} instances found on this page
                </div>
                {% endif %}
                {% if issue.details %}
                <div style="margin-top: 0.5rem; padding: 0.5rem; background: rgba(255,255,255,0.7); border-radius: 4px;">
                    <strong style="font-size: 0.85rem; color: #2d3748;">Affected Items:</strong>
                    <ul style="margin: 0.25rem 0 0 1rem; font-size: 0.8rem; color: #4a5568;">
                        {% for detail in issue.details %}
                        <li style="margin-bottom: 0.2rem;"><code style="background: rgba(0,0,0,0.1); padding: 1px 3px; border-radius: 2px;">{{ detail }}</code></li>
                        {% endfor %}
                        {% if issue.count > issue.details|length %}
                        <li style="font-style: italic; color: #718096;">...and {{ issue.count - issue.details|length }} more</li>
                        {% endif %}
                    </ul>
                </div>
                {% endif %}
            </div>
        </div>
        {% endfor %}
    </div>
    {% endif %}
    
    <!-- Low Severity Issues -->
    {% set low_issues = data.accessibility.issues | selectattr("severity", "equalto", "low") | list %}
    {% if low_issues %}
    <div style="margin-bottom: 2rem;">
        <h3 style="color: #38a169; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
            <i class="fas fa-info-circle"></i> Low Severity Issues ({{ low_issues|length }})
        </h3>
        {% for issue in low_issues %}
        <div class="issue-item severity-low">
            <i class="fas fa-info-circle issue-icon" style="color: #38a169;"></i>
            <div class="issue-content">
                <h4>{{ issue.type }} <span class="status-badge priority-low">{{ issue.severity|title }}</span></h4>
                <div class="issue-description">{{ issue.description }}</div>
                <div class="issue-guideline">{{ issue.wcag_guideline }}</div>
                <div style="margin-top: 0.5rem; padding: 0.5rem; background: #c6f6d5; border-radius: 6px; border-left: 3px solid #38a169;">
                    <strong style="color: #22543d;">Page:</strong> 
                    <code style="background: rgba(0,0,0,0.1); padding: 2px 4px; border-radius: 3px; font-size: 0.85rem;">{{ issue.page_url }}</code>
                </div>
                {% if issue.count > 1 %}
                <div style="margin-top: 0.5rem; font-size: 0.9rem; color: #718096;">
                    <i class="fas fa-layer-group"></i> {{ issue.count }} instances found on this page
                </div>
                {% endif %}
                {% if issue.details %}
                <div style="margin-top: 0.5rem; padding: 0.5rem; background: rgba(255,255,255,0.7); border-radius: 4px;">
                    <strong style="font-size: 0.85rem; color: #2d3748;">Affected Items:</strong>
                    <ul style="margin: 0.25rem 0 0 1rem; font-size: 0.8rem; color: #4a5568;">
                        {% for detail in issue.details %}
                        <li style="margin-bottom: 0.2rem;"><code style="background: rgba(0,0,0,0.1); padding: 1px 3px; border-radius: 2px;">{{ detail }}</code></li>
                        {% endfor %}
                        {% if issue.count > issue.details|length %}
                        <li style="font-style: italic; color: #718096;">...and {{ issue.count - issue.details|length }} more</li>
                        {% endif %}
                    </ul>
                </div>
                {% endif %}
            </div>
        </div>
        {% endfor %}
    </div>
    {% endif %}
</div>
{% endif %}


{% endblock %}